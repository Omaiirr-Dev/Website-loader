<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Loader</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --text-color: #f0f0f0;
            --card-bg: #2d2d2d;
            --border-color: #444;
            --button-bg: #4CAF50;
            --button-hover: #45a049;
            --warning-color: #f44336;
            --good-table-bg: rgba(144, 238, 144, 0.1);
            --irrelevant-table-bg: rgba(255, 182, 193, 0.1);
            --table-header-bg: #333;
            --table-row-even: #3a3a3a;
            --shortcut-bg: #333;
            --notification-bg: #333;
        }
        
        body.light-mode {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --card-bg: white;
            --border-color: #ddd;
            --button-bg: #4CAF50;
            --button-hover: #45a049;
            --warning-color: #f44336;
            --good-table-bg: rgba(144, 238, 144, 0.2);
            --irrelevant-table-bg: rgba(255, 182, 193, 0.2);
            --table-header-bg: #f2f2f2;
            --table-row-even: #f9f9f9;
            --shortcut-bg: #e9f7ef;
            --notification-bg: #333;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        h1, h2 {
            color: var(--text-color);
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }
        .theme-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            background-color: var(--card-bg);
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .input-section {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
        }
        .current-site {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid var(--border-color);
        }
        .current-site h2 {
            margin-top: 0;
        }
        .site-display {
            font-size: 18px;
            margin: 15px 0;
            word-break: break-all;
            text-align: center;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tables-section {
            display: flex;
            gap: 20px;
        }
        .table-container {
            flex: 1;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
        }
        .table-container:first-child {
            background-color: var(--good-table-bg);
        }
        .table-container:last-child {
            background-color: var(--irrelevant-table-bg);
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: var(--table-header-bg);
            color: var(--text-color);
        }
        tr:nth-child(even) {
            background-color: var(--table-row-even);
        }
        a {
            color: #4CAF50;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        button {
            padding: 10px 18px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            margin: 0 3px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button:hover {
            background-color: var(--button-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        /* Sleek minimalistic action buttons */
        .action-btn {
            padding: 4px 8px;
            font-size: 10px;
            border-radius: 3px;
            border: 1px solid;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.15s ease;
            margin: 0 1px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            opacity: 0.9;
            min-width: 45px;
        }
        
        .action-btn:hover {
            opacity: 1;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        
        .move-btn {
            border-color: #ff9800;
            color: #fff;
            background-color: #ff9800;
        }
        
        .move-btn:hover {
            background-color: #f57c00;
        }
        
        .remove-btn {
            border-color: #f44336;
            color: #fff;
            background-color: #f44336;
        }
        
        .remove-btn:hover {
            background-color: #d32f2f;
        }
        
        .move-good-btn {
            border-color: #4caf50;
            color: #fff;
            background-color: #4caf50;
        }
        
        .move-good-btn:hover {
            background-color: #388e3c;
        }
        textarea {
            width: 95%;
            height: 150px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
            background-color: var(--card-bg);
            color: var(--text-color);
            display: block;
            margin-bottom: 15px;
        }
        .shortcut-info {
            background-color: var(--shortcut-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }
        
        .shortcut-info ul {
            padding-left: 20px;
        }
        
        .shortcut-info li {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        .shortcut-key {
            font-weight: bold;
            background-color: var(--card-bg);
            color: var(--text-color);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            margin: 0 5px;
            display: inline-block;
        }
        
        /* Notification styles removed */
        
        /* Reset button styles */
        .nav-reset-button {
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            margin-left: auto;
            display: inline-block;
        }
        
        .nav-reset-button:hover {
            background-color: #c0392b;
        }
        
        .table-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .combined-table-container {
            margin-top: 25px;
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid var(--border-color);
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background-color: rgba(150, 150, 150, 0.1);
        }
        
        .filter-btn.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .good-site-row {
            background-color: rgba(129, 199, 132, 0.1) !important;
        }
        
        .irrelevant-site-row {
            background-color: rgba(239, 154, 154, 0.1) !important;
        }
        
        .nav-links {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .nav-links a {
            color: var(--text-color);
            text-decoration: none;
            padding: 8px 15px;
            background-color: var(--card-bg);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }
        
        .nav-links a:hover {
            background-color: rgba(150, 150, 150, 0.1);
        }
        
        .nav-links a.active {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        /* The best-time class is kept for backward compatibility */
        .best-time {
            display: none; /* Hide the old timer position */
        }
    </style>
</head>
<body>
    <!-- Notification system removed -->
    <div class="container">

        <div class="theme-toggle">
            <span style="color: var(--text-color);">Dark</span>
            <label class="switch">
                <input type="checkbox" id="theme-switch">
                <span class="slider"></span>
            </label>
            <span style="color: var(--text-color);">Light</span>
            <button id="reset-button" style="background-color: var(--warning-color); color: white; border: none; border-radius: 4px; padding: 8px 15px; cursor: pointer; font-size: 0.85em; margin-left: 15px;">Reset All Data</button>
            
        </div>
        
        <!-- Compact Shortcuts Panel -->
        <div class="shortcuts-panel" style="position: fixed; top: 20px; right: 20px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; font-size: 13px; box-shadow: 0 2px 12px rgba(0,0,0,0.15); max-width: 220px; z-index: 1000;">
            <div style="font-weight: bold; margin-bottom: 8px; color: var(--text-color); font-size: 14px; text-align: center;">⌨️ Shortcuts</div>
            <div style="display: grid; gap: 4px; color: var(--text-color);">
                <div><kbd style="background: rgba(255,183,77,0.2); color: #FFB74D; padding: 3px 6px; border-radius: 3px; font-size: 11px; font-weight: bold;">Ctrl+E</kbd> Open site</div>
                <div><kbd style="background: rgba(129,199,132,0.2); color: #81C784; padding: 3px 6px; border-radius: 3px; font-size: 11px; font-weight: bold;">Ctrl+A</kbd> Good (Non-live)</div>
                <div><kbd style="background: rgba(76,175,80,0.2); color: #4CAF50; padding: 3px 6px; border-radius: 3px; font-size: 11px; font-weight: bold;">Ctrl+D</kbd> Good (Live)</div>
                <div><kbd style="background: rgba(239,154,154,0.2); color: #EF9A9A; padding: 3px 6px; border-radius: 3px; font-size: 11px; font-weight: bold;">Ctrl+S</kbd> Irrelevant</div>
            </div>
        </div>
        

        <h1>Website Loader</h1>
        
        <div class="nav-links">
            <a href="index.html" class="active">Main Tool</a>
            <a href="compare.html">Compare & Filter</a>
        </div>
        

        
        <div class="input-section">
            <h2>Step 1: Load Sites</h2>
            <p>Enter one URL per line:</p>
            <textarea id="website-input" placeholder="https://example.com
https://another-example.com"></textarea>
            
            <button id="load-sites">Load Sites</button>
        </div>
        
        <div style="margin: 20px 0; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--card-bg); box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2 style="margin: 0 0 15px 0; color: var(--text-color); font-size: 1.3em;">Step 2: Smart Filter System (Optional)</h2>
            <p style="margin: 0 0 15px 0; color: var(--text-color); font-size: 14px; background-color: rgba(76, 175, 80, 0.1); padding: 10px; border-radius: 5px; border-left: 4px solid #4CAF50;"><strong>Instructions:</strong> Use the filters below to automatically move unwanted sites to the irrelevant section.</p>
            <div style="margin-bottom: 12px;">
                <label for="filter-words" style="display: block; margin-bottom: 8px; color: var(--text-color); font-weight: 500;">Filter words (comma-separated):</label>
                <input type="text" id="filter-words" placeholder="hello, spam, bad, unwanted" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 5px; background-color: var(--input-bg); color: var(--text-color); font-size: 14px; box-sizing: border-box;">
            </div>
            <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 10px;">
                <button id="manual-filter" style="padding: 8px 16px; background-color: #ccc; color: #666; border: none; border-radius: 4px; cursor: not-allowed; font-size: 14px; font-weight: 500;" disabled>Filter Sites</button>
                <button id="adult-filter" style="padding: 8px 16px; background-color: #ccc; color: #666; border: none; border-radius: 4px; cursor: not-allowed; font-size: 14px; font-weight: 500;" disabled>Filter Adult Content</button>
            </div>
            <div id="filter-status" style="font-size: 12px; color: #888; font-style: italic;">Ready to filter loaded sites</div>
        </div>
        
        <div class="current-site">
            <h2>Current Site</h2>
            <div id="site-counter" style="text-align: center; margin-bottom: 15px;">
                <div style="color: #FF0000; font-size: 20px; font-weight: bold;">
                    Remaining: <span id="remaining-sites">0</span>
                </div>
            </div>
            <div id="current-site-display" class="site-display">No site loaded</div>
            <div class="controls">
                <button id="open-site" style="background-color: #FFB74D;">Open Site (Ctrl/Cmd+E)</button>
                <button id="add-good" style="background-color: #81C784;">Add to Good Non-live (Ctrl/Cmd+A)</button>
                <button id="add-irrelevant" style="background-color: #EF9A9A;">Add to Irrelevant (Ctrl/Cmd+S)</button>
                <button id="add-good-live" style="background-color: #4CAF50;">Add to Good Live (Ctrl/Cmd+D)</button>
            </div>
        </div>
        
        <div class="tables-section">
            <div class="table-container">
                <h2>Good Sites</h2>
                <table id="good-sites-table">
                    <thead>
                        <tr>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="table-actions">
                    <button id="copy-good-sites">Copy Table</button>
                    <button id="clear-good-sites">Delete Table</button>
                </div>
            </div>
            
            <div class="table-container">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <h2 style="margin: 0;">Irrelevant Sites</h2>
                    <button id="scroll-to-bottom" style="background-color: #2196F3; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3); transition: all 0.2s ease;" onmouseover="this.style.backgroundColor='#1976D2'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(33, 150, 243, 0.4)'" onmouseout="this.style.backgroundColor='#2196F3'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(33, 150, 243, 0.3)'">⬇ Scroll to Bottom</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <label for="irrelevant-label" style="margin-right: 10px;">Custom Label:</label>
                    <input type="text" id="irrelevant-label" placeholder="Irrelevant" value="Irrelevant" style="padding: 4px 8px; border: 1px solid var(--border-color); border-radius: 3px; background-color: var(--card-bg); color: var(--text-color); width: 120px;">
                </div>
                <table id="irrelevant-sites-table">
                    <thead>
                        <tr>
                            <th>URL</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <div class="table-actions">
                    <button id="copy-irrelevant-sites">Copy Table</button>
                    <button id="clear-irrelevant-sites">Delete Table</button>
                </div>
            </div>
        </div>
        
        <div class="combined-table-container">
            <h2>Combined Sites (Chronological Order)</h2>
            <div class="filter-controls">
                <button id="show-all" class="filter-btn active">Show All</button>
                <button id="show-good" class="filter-btn">Show Good Only</button>
                <button id="show-irrelevant" class="filter-btn">Show Irrelevant Only</button>
            </div>
            <table id="combined-sites-table">
                <thead>
                    <tr>
                        <th>URL</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="table-actions">
                <button id="copy-combined-sites">Copy Table</button>
            </div>
        </div>
    </div>

    <script src="simple_adult_filter.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State variables
            let websites = [];
            let currentIndex = -1;
            let goodSites = [];
            let irrelevantSites = [];
            let combinedSites = []; // Array to store sites in chronological order with type info
            let sequenceCounter = 1; // Global counter for maintaining chronological order
            let siteSequenceMap = new Map(); // Maps site URLs to their original sequence numbers
            
            // DOM elements
            const websiteInput = document.getElementById('website-input');
            const loadSitesBtn = document.getElementById('load-sites');
            const filterWordsInput = document.getElementById('filter-words');
            const manualFilterBtn = document.getElementById('manual-filter');
            const adultFilterBtn = document.getElementById('adult-filter');

            const filterStatus = document.getElementById('filter-status');
            const currentSiteDisplay = document.getElementById('current-site-display');

            const openSiteBtn = document.getElementById('open-site');
            const addGoodBtn = document.getElementById('add-good');
            const addGoodLiveBtn = document.getElementById('add-good-live');
            const addIrrelevantBtn = document.getElementById('add-irrelevant');
            const irrelevantLabelInput = document.getElementById('irrelevant-label');
            const goodSitesTable = document.getElementById('good-sites-table').querySelector('tbody');
            const irrelevantSitesTable = document.getElementById('irrelevant-sites-table').querySelector('tbody');
            const combinedSitesTable = document.getElementById('combined-sites-table').querySelector('tbody');
            
            // Counter element
            const remainingSitesCounter = document.getElementById('remaining-sites');
            
            // Filter buttons
            const showAllBtn = document.getElementById('show-all');
            const showGoodBtn = document.getElementById('show-good');
            const showIrrelevantBtn = document.getElementById('show-irrelevant');
            

            
            // Table action buttons
            const copyGoodSitesBtn = document.getElementById('copy-good-sites');
            const clearGoodSitesBtn = document.getElementById('clear-good-sites');
            const copyIrrelevantSitesBtn = document.getElementById('copy-irrelevant-sites');
            const clearIrrelevantSitesBtn = document.getElementById('clear-irrelevant-sites');
            const copyCombinedSitesBtn = document.getElementById('copy-combined-sites');
            const scrollToBottomBtn = document.getElementById('scroll-to-bottom');
            
            // Track window focus for better tab management
            let windowHasFocus = true;
            window.addEventListener('focus', function() {
                windowHasFocus = true;
            });
            window.addEventListener('blur', function() {
                windowHasFocus = false;
            });
            
            // Save website input in real-time
            websiteInput.addEventListener('input', function() {
                localStorage.setItem('sitesTextareaContent', websiteInput.value);
            });
            
            // Update live counter function
            function updateSiteCounter() {
                const remainingSites = websites.length; // All sites in the websites array are remaining to be processed
                remainingSitesCounter.textContent = remainingSites;
            }
            
            // New robust filtering system
            function updateFilterStatus() {
                if (filterWordsInput.value.trim()) {
                    filterStatus.textContent = `Filter ready: "${filterWordsInput.value.trim()}"`;
                    filterStatus.style.color = '#4CAF50';
                } else {
                    filterStatus.textContent = 'Enter filter words to begin';
                    filterStatus.style.color = '#888';
                }
            }
            
            function performFiltering() {
                 const filterWords = filterWordsInput.value.trim();
                 if (!filterWords) {
                     return;
                 }
                 
                 const words = filterWords.toLowerCase().split(',')
                     .map(word => word.trim())
                     .filter(word => word !== '');
                 
                 if (words.length === 0) {
                     return;
                 }
                 
                 const currentText = websiteInput.value.trim();
                 if (!currentText) {
                     return;
                 }
                 
                 const lines = currentText.split('\n')
                     .map(line => line.trim())
                     .filter(line => line !== '');
                 
                 const filteredOut = [];
                 const remaining = [];
                 
                 // Process each line with its original position-based sequence number
                 lines.forEach((line, index) => {
                     const lineLower = line.toLowerCase();
                     const shouldFilter = words.some(word => lineLower.includes(word));
                     
                     if (shouldFilter) {
                         // Add to irrelevant sites with sequence number based on original position
                         if (!irrelevantSites.includes(line)) {
                             irrelevantSites.push(line);
                             combinedSites.push({
                                 url: line,
                                 type: 'irrelevant',
                                 sequence: sequenceCounter + index // Use original position
                             });
                         }
                         filteredOut.push(line);
                     } else {
                         remaining.push(line);
                     }
                 });
                 
                 // Update sequence counter to account for all processed lines
                 sequenceCounter += lines.length;
                 
                 // Update the textarea with remaining sites
                 websiteInput.value = remaining.join('\n');
                 
                 // Update websites array to match the filtered textarea content
                 websites = remaining.slice(); // Copy the remaining sites
                 
                 // Update current site display to show first remaining site
                 if (websites.length > 0) {
                     currentIndex = 0;
                     updateCurrentSiteDisplay();
                     updateSiteCounter(); // Update live counter
                 } else {
                     currentIndex = -1;
                     currentSiteDisplay.textContent = 'No sites remaining';
                     updateSiteCounter(); // Update live counter
                 }
                 
                 // Update tables
                 updateIrrelevantSitesTable();
                 updateCombinedSitesTable();
                 
                 // Save changes
                 saveToLocalStorage();
                 
                 // Show results
                 // Filtering completed silently
             }
            
            // Save filter settings in real-time
            filterWordsInput.addEventListener('input', function() {
                localStorage.setItem('filterWords', this.value);
                updateFilterStatus();
            });
            
            // Manual filter button
            manualFilterBtn.addEventListener('click', performFiltering);
            
            // Adult content filter functionality
            let adultFilter;
            try {
                adultFilter = new SimpleAdultFilter();
            } catch (error) {
                console.error('Failed to load adult content filter:', error);
            }
            
            function performAdultContentFiltering() {
                if (!adultFilter) {
                    console.log('Adult content filter not available');
                    return;
                }
                
                const input = websiteInput.value.trim();
                if (!input) {
                    return;
                }
                
                const lines = input.split('\n')
                    .map(line => line.trim())
                    .filter(line => line !== '');
                
                if (lines.length === 0) {
                    return;
                }
                
                const filteredOut = [];
                const remaining = [];
                
                lines.forEach(line => {
                    let processedUrl = line;
                    if (!line.startsWith('http://') && !line.startsWith('https://')) {
                        processedUrl = 'https://' + line;
                    }
                    
                    if (adultFilter.isAdultContent(processedUrl)) {
                        filteredOut.push(line);
                    } else {
                        remaining.push(line);
                    }
                });
                
                // Update the textarea with clean sites
                websiteInput.value = remaining.join('\n');
                
                // Add filtered sites to irrelevant
                filteredOut.forEach(site => {
                    let processedUrl = site;
                    if (!site.startsWith('http://') && !site.startsWith('https://')) {
                        processedUrl = 'https://' + site;
                    }
                    
                    if (!irrelevantSites.includes(processedUrl)) {
                        irrelevantSites.push(processedUrl);
                        
                        const originalSequence = siteSequenceMap.get(processedUrl) || sequenceCounter++;
                        combinedSites.push({
                            url: processedUrl,
                            type: 'irrelevant',
                            sequence: originalSequence
                        });
                    }
                });
                
                // Update websites array
                websites = remaining.map(site => {
                    if (!site.startsWith('http://') && !site.startsWith('https://')) {
                        return 'https://' + site;
                    }
                    return site;
                });
                
                // Update display
                if (websites.length > 0) {
                    currentIndex = 0;
                    updateCurrentSiteDisplay();
                    updateSiteCounter();
                } else {
                    currentIndex = -1;
                    currentSiteDisplay.textContent = 'No sites remaining';
                    updateSiteCounter();
                }
                
                updateIrrelevantSitesTable();
                updateCombinedSitesTable();
                saveToLocalStorage();
                
                if (filteredOut.length > 0) {
                    console.log('Filtered adult sites:', filteredOut);
                    console.log('Remaining sites:', websites.length);
                }
            }
            
            // Adult filter button
            adultFilterBtn.addEventListener('click', performAdultContentFiltering);
            

            
            // Initialize filter status
            updateFilterStatus();
            
            // Save custom irrelevant label and update table
            irrelevantLabelInput.addEventListener('input', function() {
                localStorage.setItem('irrelevantLabel', this.value);
                updateCombinedSitesTable();
            });
            
            // Load sites from input
            loadSitesBtn.addEventListener('click', function() {
                const input = websiteInput.value.trim();
                if (!input) {
                    return;
                }
                
                // Parse all sites and assign sequence numbers IMMEDIATELY
                const allSites = input.split('\n')
                    .map(line => line.trim())
                    .filter(line => line !== '')
                    .map((site, index) => {
                        // Add https:// if no protocol is specified
                        let processedUrl = site;
                        if (!site.startsWith('http://') && !site.startsWith('https://')) {
                            processedUrl = 'https://' + site;
                        }
                        
                        return {
                            url: processedUrl,
                            originalUrl: site,
                            originalSequence: sequenceCounter + index,
                            isFiltered: false
                        };
                    });
                
                if (allSites.length === 0) {
                    return;
                }
                
                // Store original sequence numbers in the map for later use
                allSites.forEach(siteObj => {
                    // Store both original URL and processed URL mappings
                    siteSequenceMap.set(siteObj.originalUrl, siteObj.originalSequence);
                    siteSequenceMap.set(siteObj.url, siteObj.originalSequence);
                    console.log(`Mapped ${siteObj.originalUrl} to sequence ${siteObj.originalSequence}`);
                });
                console.log('Complete siteSequenceMap:', Array.from(siteSequenceMap.entries()));
                
                // Update sequence counter for future loads
                sequenceCounter += allSites.length;
                
                // Set websites array to all loaded sites (no auto-filtering)
                websites = allSites.map(siteObj => siteObj.url);
                
                // Enable filter buttons
                manualFilterBtn.disabled = false;
                manualFilterBtn.style.backgroundColor = '#FF9800';
                manualFilterBtn.style.color = 'white';
                manualFilterBtn.style.cursor = 'pointer';
                
                adultFilterBtn.disabled = false;
                adultFilterBtn.style.backgroundColor = '#E91E63';
                adultFilterBtn.style.color = 'white';
                adultFilterBtn.style.cursor = 'pointer';
                
                // Set current index and display
                currentIndex = 0;
                updateCurrentSiteDisplay();
                updateSiteCounter(); // Update live counter
                
                saveToLocalStorage(); // Save the current state
            });
            

            
            // Open site in new tab
            openSiteBtn.addEventListener('click', function() {
                openCurrentSite();
            });
            
            // Add to good sites
            addGoodBtn.addEventListener('click', function() {
                addToGoodSites();
            });
            
            // Add to good sites as Live
            addGoodLiveBtn.addEventListener('click', function() {
                addToGoodSites('Live');
            });
            
            // Add to irrelevant sites
            addIrrelevantBtn.addEventListener('click', function() {
                addToIrrelevantSites();
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // Only process shortcuts when this window has focus
                if (windowHasFocus) {
                    // Shift key combinations are kept for backward compatibility
                    if (event.shiftKey) {
                        if (event.key === 'D' || event.key === 'd') {
                            openCurrentSite();
                            event.preventDefault();
                        } else if (event.key === 'S' || event.key === 's') {
                            addToGoodSites();
                            event.preventDefault();
                        } else if (event.key === 'A' || event.key === 'a') {
                            addToIrrelevantSites();
                            event.preventDefault();
                        } else if (event.key === 'N' || event.key === 'n') {
                            goToNextSiteAndOpen();
                            event.preventDefault();
                        }
                    }
                    
                    // Handle Ctrl (Windows/Linux) and Cmd (Mac) key combinations
                    if (event.ctrlKey || event.metaKey) {
                        const modifierKey = event.metaKey ? 'Cmd' : 'Ctrl';
                        
                        // Custom shortcuts
                        if (event.key === 'e' || event.key === 'E') {
                            // Ctrl+E or Cmd+E to open the loaded site
                            openCurrentSite();
                            event.preventDefault();
                            return false;
                        } else if (event.key === 'a' || event.key === 'A') {
                            // Ctrl+A or Cmd+A to add to good sites as Non-live
                            addToGoodSites('Non-live');
                            event.preventDefault();
                            return false;
                        } else if (event.key === 'd' || event.key === 'D') {
                            // Ctrl+D or Cmd+D to add to good sites as Live
                            addToGoodSites('Live');
                            event.preventDefault();
                            return false;
                        } else if (event.key === 's' || event.key === 'S') {
                            // Ctrl+S or Cmd+S to add to irrelevant sites
                            addToIrrelevantSites();
                            event.preventDefault();
                            return false;

                        }
                        // Allow Ctrl+C, Ctrl+V, Ctrl+F, and Ctrl+R (or Cmd equivalents on Mac)
                        else if (event.key === 'c' || event.key === 'C' || 
                                 event.key === 'v' || event.key === 'V' || 
                                 event.key === 'f' || event.key === 'F' || 
                                 event.key === 'r' || event.key === 'R') {
                            // Let these pass through
                            return true;
                        }
                        // Prevent other shortcuts silently
                        else if (event.key === 'w' || event.key === 'W') {
                            // Prevent close tab
                        } else if (event.key === 'p' || event.key === 'P') {
                            // Prevent print
                        } else {
                            // Prevent other shortcuts
                        }
                        
                        // Prevent default for other Ctrl/Cmd combinations
                        event.preventDefault();
                        return false;
                    }
                }
            });
            
            // Right-click is now enabled - removed the context menu prevention
            
            // Listen for window focus to detect when user returns from a tab
            window.addEventListener('focus', function() {
                // This will trigger when user closes a tab with Ctrl+W and returns to this app
                console.log('Window regained focus - user may have returned from a tab');
            });
            
            // Notification system removed - all notifications are now silent
            
            // Helper functions
            function goToNextSite() {
                if (websites.length === 0) return false;
                
                currentIndex = (currentIndex + 1) % websites.length;
                updateCurrentSiteDisplay();
                return true;
            }
            
            function goToNextSiteAndOpen() {
                if (goToNextSite()) {
                    openCurrentSite();
                }
            }
            
            function updateCurrentSiteDisplay() {
                if (currentIndex >= 0 && currentIndex < websites.length) {
                    // Clear the display
                    currentSiteDisplay.innerHTML = '';
                    
                    // Create a clickable link
                    const urlLink = document.createElement('a');
                    urlLink.href = websites[currentIndex];
                    urlLink.textContent = websites[currentIndex];
                    urlLink.target = '_blank';
                    urlLink.style.color = 'var(--text-color)';
                    urlLink.style.textDecoration = 'underline';
                    urlLink.style.cursor = 'pointer';
                    
                    currentSiteDisplay.appendChild(urlLink);
                } else {
                    currentSiteDisplay.textContent = 'No site loaded';
                }
            }
            
            function openCurrentSite() {
                if (currentIndex >= 0 && currentIndex < websites.length) {
                    window.open(websites[currentIndex], '_blank');
                }
            }
            
            function addToGoodSites(status = 'Non-live') {
                if (currentIndex >= 0 && currentIndex < websites.length) {
                    const site = websites[currentIndex];
                    
                    // Check if site is already in good sites
                    const existingSite = goodSites.find(item => item.url === site);
                    if (!existingSite) {
                        goodSites.push({
                            url: site,
                            status: status
                        });
                        updateGoodSitesTable();
                        
                        // Add to combined sites with type info and original sequence number
                        const originalSequence = siteSequenceMap.get(site) || sequenceCounter++;
                        combinedSites.push({
                            url: site,
                            type: 'good',
                            status: status,
                            sequence: originalSequence
                        });
                        updateCombinedSitesTable();
                        
                        // Save to localStorage
                        saveToLocalStorage();
                    }
                    
                    // Move to next site
                    if (websites.length > 1) {
                        websites.splice(currentIndex, 1);
                        if (currentIndex >= websites.length) {
                            currentIndex = 0;
                        }
                        updateCurrentSiteDisplay();
                        updateSiteCounter(); // Update live counter
                    } else {
                        websites = [];
                        currentIndex = -1;
                        currentSiteDisplay.textContent = 'No site loaded';
                        updateSiteCounter(); // Update live counter
                    }
                }
            }
            
            function addToGoodSitesLive() {
                addToGoodSites('Live');
            }
            
            function addToGoodSitesNonLive() {
                addToGoodSites('Non-live');
            }
            
            function addToIrrelevantSites() {
                if (currentIndex >= 0 && currentIndex < websites.length) {
                    const site = websites[currentIndex];
                    
                    // Check if site is already in irrelevant sites
                    if (!irrelevantSites.includes(site)) {
                        irrelevantSites.push(site);
                        updateIrrelevantSitesTable();
                        
                        // Add to combined sites with type info and original sequence number
                        const originalSequence = siteSequenceMap.get(site) || sequenceCounter++;
                        console.log(`Adding ${site} to irrelevant with sequence ${originalSequence}`);
                        combinedSites.push({
                            url: site,
                            type: 'irrelevant',
                            sequence: originalSequence
                        });
                        console.log('Current combinedSites:', combinedSites.map(s => ({url: s.url, seq: s.sequence, type: s.type})));
                        updateCombinedSitesTable();
                        
                        // Save to localStorage
                        saveToLocalStorage();
                    }
                    
                    // Move to next site
                    if (websites.length > 1) {
                        websites.splice(currentIndex, 1);
                        if (currentIndex >= websites.length) {
                            currentIndex = 0;
                        }
                        updateCurrentSiteDisplay();
                        updateSiteCounter(); // Update live counter
                    } else {
                        websites = [];
                        currentIndex = -1;
                        currentSiteDisplay.textContent = 'No site loaded';
                        updateSiteCounter(); // Update live counter
                    }
                }
            }
            
            function updateGoodSitesTable() {
                goodSitesTable.innerHTML = '';
                
                goodSites.forEach((siteObj, index) => {
                    const row = document.createElement('tr');
                    
                    const urlCell = document.createElement('td');
                    const urlLink = document.createElement('a');
                    urlLink.href = siteObj.url;
                    urlLink.textContent = siteObj.url;
                    urlLink.target = '_blank';
                    urlCell.appendChild(urlLink);
                    
                    const statusCell = document.createElement('td');
                    const statusSelect = document.createElement('select');
                    statusSelect.innerHTML = '<option value="Live">Live</option><option value="Non-live">Non-live</option>';
                    statusSelect.value = siteObj.status;
                    statusSelect.addEventListener('change', function() {
                        // Update the status in the goodSites array
                        goodSites[index].status = this.value;
                        
                        // Update the status in the combinedSites array
                        const combinedIndex = combinedSites.findIndex(item => item.url === siteObj.url && item.type === 'good');
                        if (combinedIndex !== -1) {
                            combinedSites[combinedIndex].status = this.value;
                        }
                        
                        // Refresh the combined sites table to show the change
                        updateCombinedSitesTable();
                        
                        // Save to localStorage
                        saveToLocalStorage();
                        
                        // Status updated silently
                    });
                    statusCell.appendChild(statusSelect);
                    
                    const actionsCell = document.createElement('td');
                    
                    const swapBtn = document.createElement('button');
                    swapBtn.textContent = 'Move';
                    swapBtn.className = 'action-btn move-btn';
                    swapBtn.title = 'Move to Bad';
                    swapBtn.addEventListener('click', function() {
                        // Remove from good sites
                        goodSites.splice(index, 1);
                        // Add to irrelevant sites
                        irrelevantSites.push(siteObj.url);
                        
                        // Update combined sites array
                        const combinedIndex = combinedSites.findIndex(item => item.url === siteObj.url && item.type === 'good');
                        if (combinedIndex !== -1) {
                            combinedSites[combinedIndex].type = 'irrelevant';
                            delete combinedSites[combinedIndex].status; // Remove status for irrelevant sites
                        }
                        
                        // Update tables
                        updateGoodSitesTable();
                        updateIrrelevantSitesTable();
                        updateCombinedSitesTable();
                        
                        // Update localStorage
                        saveToLocalStorage();
                        
                        showNotification('Site moved to irrelevant');
                    });
                    actionsCell.appendChild(swapBtn);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Delete';
                    removeBtn.className = 'action-btn remove-btn';
                    removeBtn.title = 'Remove';
                    removeBtn.addEventListener('click', function() {
                        // Remove from good sites array
                        goodSites.splice(index, 1);
                        updateGoodSitesTable();
                        
                        // Remove from combined sites array
                        const combinedIndex = combinedSites.findIndex(item => item.url === siteObj.url && item.type === 'good');
                        if (combinedIndex !== -1) {
                            combinedSites.splice(combinedIndex, 1);
                            updateCombinedSitesTable();
                        }
                        
                        // Update localStorage
                        saveToLocalStorage();
                    });
                    actionsCell.appendChild(removeBtn);
                    
                    row.appendChild(urlCell);
                    row.appendChild(statusCell);
                    row.appendChild(actionsCell);
                    goodSitesTable.appendChild(row);
                });
                
                // Update localStorage
                saveToLocalStorage();
            }
            
            function updateIrrelevantSitesTable() {
                irrelevantSitesTable.innerHTML = '';
                
                irrelevantSites.forEach((site, index) => {
                    const row = document.createElement('tr');
                    
                    const urlCell = document.createElement('td');
                    const urlLink = document.createElement('a');
                    urlLink.href = site;
                    urlLink.textContent = site;
                    urlLink.target = '_blank';
                    urlCell.appendChild(urlLink);
                    
                    const actionsCell = document.createElement('td');
                    
                    const swapBtn = document.createElement('button');
                    swapBtn.textContent = 'Move';
                    swapBtn.className = 'action-btn move-good-btn';
                    swapBtn.title = 'Move to Good';
                    swapBtn.addEventListener('click', function() {
                        // Remove from irrelevant sites
                        irrelevantSites.splice(index, 1);
                        // Add to good sites with default Non-live status
                        goodSites.push({
                            url: site,
                            status: 'Non-live'
                        });
                        
                        // Update combined sites array
                        const combinedIndex = combinedSites.findIndex(item => item.url === site && item.type === 'irrelevant');
                        if (combinedIndex !== -1) {
                            combinedSites[combinedIndex].type = 'good';
                            combinedSites[combinedIndex].status = 'Non-live';
                        }
                        
                        // Update tables
                        updateGoodSitesTable();
                        updateIrrelevantSitesTable();
                        updateCombinedSitesTable();
                        
                        // Update localStorage
                        saveToLocalStorage();
                        
                        showNotification('Site moved to good');
                    });
                    actionsCell.appendChild(swapBtn);
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Delete';
                    removeBtn.className = 'action-btn remove-btn';
                    removeBtn.title = 'Remove';
                    removeBtn.addEventListener('click', function() {
                        // Remove from irrelevant sites array
                        irrelevantSites.splice(index, 1);
                        updateIrrelevantSitesTable();
                        
                        // Remove from combined sites array
                        const combinedIndex = combinedSites.findIndex(item => item.url === site && item.type === 'irrelevant');
                        if (combinedIndex !== -1) {
                            combinedSites.splice(combinedIndex, 1);
                            updateCombinedSitesTable();
                        }
                        
                        // Update localStorage
                        saveToLocalStorage();
                    });
                    actionsCell.appendChild(removeBtn);
                    
                    row.appendChild(urlCell);
                    row.appendChild(actionsCell);
                    irrelevantSitesTable.appendChild(row);
                });
                
                // Update localStorage
                saveToLocalStorage();
            }
            
            function updateCombinedSitesTable() {
                combinedSitesTable.innerHTML = '';
                
                // Get current filter
                const currentFilter = document.querySelector('.filter-btn.active').id;
                
                // Filter sites based on current filter
                let filteredSites = [];
                if (currentFilter === 'show-all') {
                    filteredSites = combinedSites;
                } else if (currentFilter === 'show-good') {
                    filteredSites = combinedSites.filter(site => site.type === 'good');
                } else if (currentFilter === 'show-irrelevant') {
                    filteredSites = combinedSites.filter(site => site.type === 'irrelevant');
                }
                
                // Sort by sequence number to maintain chronological order
                filteredSites.sort((a, b) => (a.sequence || 0) - (b.sequence || 0));
                
                // Create table rows
                filteredSites.forEach((site, index) => {
                    const row = document.createElement('tr');
                    row.classList.add(site.type === 'good' ? 'good-site-row' : 'irrelevant-site-row');
                    
                    const urlCell = document.createElement('td');
                    const urlLink = document.createElement('a');
                    urlLink.href = site.url;
                    urlLink.textContent = site.url;
                    urlLink.target = '_blank';
                    urlCell.appendChild(urlLink);
                    
                    const typeCell = document.createElement('td');
                    const customLabel = irrelevantLabelInput.value.trim() || 'Irrelevant';
                    typeCell.textContent = site.type === 'good' ? 'Good' : customLabel;
                    typeCell.style.color = site.type === 'good' ? '#81C784' : '#EF9A9A';
                    typeCell.style.fontWeight = 'bold';
                    
                    const statusCell = document.createElement('td');
                    if (site.type === 'good' && site.status) {
                        statusCell.textContent = site.status;
                        statusCell.style.color = site.status === 'Live' ? '#4CAF50' : '#FF9800';
                        statusCell.style.fontWeight = 'bold';
                    } else {
                        statusCell.textContent = '-';
                        statusCell.style.color = '#999';
                    }
                    
                    const actionsCell = document.createElement('td');
                    const removeBtn = document.createElement('button');
                    removeBtn.textContent = 'Delete';
                    removeBtn.className = 'action-btn remove-btn';
                    removeBtn.title = 'Remove';
                    removeBtn.addEventListener('click', function() {
                        // Remove from combined sites array
                        combinedSites.splice(index, 1);
                        
                        // Also remove from respective array (good or irrelevant)
                        if (site.type === 'good') {
                            const goodIndex = goodSites.indexOf(site.url);
                            if (goodIndex !== -1) {
                                goodSites.splice(goodIndex, 1);
                                updateGoodSitesTable();
                            }
                        } else {
                            const irrelevantIndex = irrelevantSites.indexOf(site.url);
                            if (irrelevantIndex !== -1) {
                                irrelevantSites.splice(irrelevantIndex, 1);
                                updateIrrelevantSitesTable();
                            }
                        }
                        
                        updateCombinedSitesTable();
                        
                        // Update localStorage
                        saveToLocalStorage();
                    });
                    actionsCell.appendChild(removeBtn);
                    
                    row.appendChild(urlCell);
                    row.appendChild(typeCell);
                    row.appendChild(statusCell);
                    row.appendChild(actionsCell);
                    combinedSitesTable.appendChild(row);
                });
                
                // Update localStorage
                saveToLocalStorage();
            }
            

            
            // Table action functions
            function copyTableToClipboard(sites) {
                let text;
                if (sites === goodSites) {
                    // Format good sites with headers
                    const header = 'URL\tStatus';
                    const rows = sites.map(site => `${site.url}\t${site.status}`);
                    text = header + '\n' + rows.join('\n');
                } else if (sites === irrelevantSites) {
                    // Format irrelevant sites with header
                    const header = 'URL';
                    text = header + '\n' + sites.join('\n');
                } else {
                    // For other cases, just join as before
                    text = sites.join('\n');
                }
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showNotification('Table copied to clipboard');
                    })
                    .catch(err => {
                        showNotification('Failed to copy: ' + err);
                    });
            }
            
            function clearTable(sitesArray, updateFunction) {
                if (confirm('Are you sure you want to delete all items in this table?')) {
                    sitesArray.length = 0; // Clear the array
                    updateFunction();
                    saveToLocalStorage(); // Save changes to localStorage
                    // Table cleared silently
                }
            }
            
            // Function to save data to localStorage
            function saveToLocalStorage() {
                localStorage.setItem('goodSites', JSON.stringify(goodSites));
                localStorage.setItem('irrelevantSites', JSON.stringify(irrelevantSites));
                localStorage.setItem('combinedSites', JSON.stringify(combinedSites));
                localStorage.setItem('sequenceCounter', sequenceCounter);
                localStorage.setItem('siteSequenceMap', JSON.stringify(Array.from(siteSequenceMap.entries())));
                localStorage.setItem('irrelevantLabel', irrelevantLabelInput.value);
                
                // Save websites array and current index
                if (websites.length > 0) {
                    localStorage.setItem('websites', JSON.stringify(websites));
                    localStorage.setItem('currentIndex', currentIndex);
                }
                
                // Save current site textarea content
                if (websiteInput.value) {
                    localStorage.setItem('sitesTextareaContent', websiteInput.value);
                }
            }
            
            // Function to load data from localStorage
            function loadFromLocalStorage() {
                const savedGoodSites = localStorage.getItem('goodSites');
                const savedIrrelevantSites = localStorage.getItem('irrelevantSites');
                const savedCombinedSites = localStorage.getItem('combinedSites');
                const savedSequenceCounter = localStorage.getItem('sequenceCounter');
                const savedWebsites = localStorage.getItem('websites');
                const savedCurrentIndex = localStorage.getItem('currentIndex');
                const savedSitesTextareaContent = localStorage.getItem('sitesTextareaContent');
                const savedIrrelevantLabel = localStorage.getItem('irrelevantLabel');
                const savedFilterWords = localStorage.getItem('filterWords');
                const savedSiteSequenceMap = localStorage.getItem('siteSequenceMap');
                
                if (savedGoodSites) {
                    goodSites = JSON.parse(savedGoodSites);
                    updateGoodSitesTable();
                }
                
                if (savedIrrelevantSites) {
                    irrelevantSites = JSON.parse(savedIrrelevantSites);
                    updateIrrelevantSitesTable();
                }
                
                if (savedCombinedSites) {
                    combinedSites = JSON.parse(savedCombinedSites);
                    updateCombinedSitesTable();
                }
                
                // Load sequence counter
                if (savedSequenceCounter) {
                    sequenceCounter = parseInt(savedSequenceCounter);
                } else {
                    // If no saved counter, calculate next sequence based on existing sites
                    const maxSequence = Math.max(0, ...combinedSites.map(site => site.sequence || 0));
                    sequenceCounter = maxSequence + 1;
                }
                
                // Load site sequence map
                if (savedSiteSequenceMap) {
                    const mapEntries = JSON.parse(savedSiteSequenceMap);
                    siteSequenceMap = new Map(mapEntries);
                } else {
                    siteSequenceMap = new Map();
                }
                
                // Load websites and current index
                if (savedWebsites) {
                    websites = JSON.parse(savedWebsites);
                    
                    if (savedCurrentIndex) {
                        currentIndex = parseInt(savedCurrentIndex);
                    }
                    
                    // Update current site display if websites exist
                    if (websites.length > 0 && currentIndex < websites.length) {
                        updateCurrentSiteDisplay();
                    }
                }
                
                // Load sites textarea content
                if (savedSitesTextareaContent) {
                    websiteInput.value = savedSitesTextareaContent;
                }
                
                // Load custom irrelevant label
                if (savedIrrelevantLabel) {
                    irrelevantLabelInput.value = savedIrrelevantLabel;
                }
                
                // Load filter settings
                if (savedFilterWords) {
                    filterWordsInput.value = savedFilterWords;
                }
                
                // Update filter status after loading settings
                updateFilterStatus();
            }
            
            // Load saved data
            loadFromLocalStorage();
            
            // Initialize counter display
            updateSiteCounter();
            
            // Reset button functionality
            document.getElementById('reset-button').addEventListener('click', function() {
                // Save theme preference before clearing localStorage
                const currentTheme = localStorage.getItem('theme');
                
                // Clear localStorage except theme
                localStorage.removeItem('goodSites');
                localStorage.removeItem('irrelevantSites');
                localStorage.removeItem('combinedSites');
                localStorage.removeItem('sequenceCounter');
                localStorage.removeItem('siteSequenceMap');
                localStorage.removeItem('websites');
                localStorage.removeItem('currentIndex');
                localStorage.removeItem('sitesTextareaContent');
                localStorage.removeItem('filterWords');
                localStorage.removeItem('irrelevantLabel');
                
                // Restore theme preference
                if (currentTheme) {
                    localStorage.setItem('theme', currentTheme);
                }
                
                // Reset data arrays
                goodSites = [];
                irrelevantSites = [];
                combinedSites = [];
                websites = [];
                currentIndex = -1;
                sequenceCounter = 1; // Reset sequence counter
                siteSequenceMap = new Map(); // Reset sequence map
                
                // Clear all input boxes
                websiteInput.value = '';
                filterWordsInput.value = '';
                irrelevantLabelInput.value = '';
                
                // Update tables and display
                updateGoodSitesTable();
                updateIrrelevantSitesTable();
                updateCombinedSitesTable();
                updateCurrentSiteDisplay();
                updateFilterStatus();
                updateSiteCounter(); // Update live counter
                
                // All data and input boxes have been reset silently
            });
            
            // Theme toggle functionality
            const themeSwitch = document.getElementById('theme-switch');
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                themeSwitch.checked = true;
            }
            
            // Theme toggle event listener
            themeSwitch.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('light-mode');
                    localStorage.setItem('theme', 'light');
                } else {
                    document.body.classList.remove('light-mode');
                    localStorage.setItem('theme', 'dark');
                }
            });
            
            // Table action button event listeners
            copyGoodSitesBtn.addEventListener('click', function() {
                copyTableToClipboard(goodSites);
            });
            
            clearGoodSitesBtn.addEventListener('click', function() {
                clearTable(goodSites, updateGoodSitesTable);
                // Also remove good sites from combined sites
                combinedSites = combinedSites.filter(site => site.type !== 'good');
                updateCombinedSitesTable();
            });
            
            copyIrrelevantSitesBtn.addEventListener('click', function() {
                copyTableToClipboard(irrelevantSites);
            });
            
            clearIrrelevantSitesBtn.addEventListener('click', function() {
                clearTable(irrelevantSites, updateIrrelevantSitesTable);
                // Also remove irrelevant sites from combined sites
                combinedSites = combinedSites.filter(site => site.type !== 'irrelevant');
                updateCombinedSitesTable();
            });
            
            // Combined sites table actions
            copyCombinedSitesBtn.addEventListener('click', function() {
                // Get current filter
                const currentFilter = document.querySelector('.filter-btn.active').id;
                const customLabel = irrelevantLabelInput.value.trim() || 'Irrelevant';
                
                let filteredSites = [];
                
                // Filter sites based on current view
                if (currentFilter === 'show-all') {
                    filteredSites = combinedSites;
                } else if (currentFilter === 'show-good') {
                    filteredSites = combinedSites.filter(site => site.type === 'good');
                } else if (currentFilter === 'show-irrelevant') {
                    filteredSites = combinedSites.filter(site => site.type === 'irrelevant');
                }
                
                // Sort by sequence number to maintain chronological order (same as display)
                filteredSites.sort((a, b) => (a.sequence || 0) - (b.sequence || 0));
                
                // Create table content in the same order as displayed
                const header = 'URL\tType\tStatus';
                const rows = filteredSites.map(site => {
                    const type = site.type === 'good' ? 'Good' : customLabel;
                    const status = site.status || '-';
                    return `${site.url}\t${type}\t${status}`;
                });
                
                const textToCopy = header + '\n' + rows.join('\n');
                
                navigator.clipboard.writeText(textToCopy)
                    .then(() => {
                        console.log('Complete table copied to clipboard');
                    })
                    .catch(err => {
                        console.log('Failed to copy: ' + err);
                    });
            });
            
            // Filter button event listeners
            showAllBtn.addEventListener('click', function() {
                setActiveFilter(this);
                updateCombinedSitesTable();
            });
            
            showGoodBtn.addEventListener('click', function() {
                setActiveFilter(this);
                updateCombinedSitesTable();
            });
            
            showIrrelevantBtn.addEventListener('click', function() {
                setActiveFilter(this);
                updateCombinedSitesTable();
            });
            
            // Scroll to bottom button event listener
            scrollToBottomBtn.addEventListener('click', function() {
                const combinedSitesContainer = document.querySelector('.combined-table-container');
                combinedSitesContainer.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            });
            
            function setActiveFilter(button) {
                // Remove active class from all filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Add active class to clicked button
                button.classList.add('active');
            }
        });
    </script>
</body>
</html>